<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MLZoomCamp - Capstone Project</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
      }

      .container {
        background: #ffffff;
        margin-top: 60px;
        padding: 32px 40px;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        max-width: 520px;
        width: 100%;
      }

      h1 {
        margin: 0 0 8px;
        font-size: 24px;
      }

      p.subtitle {
        margin: 0 0 24px;
        color: #555;
      }

      .field {
        margin-bottom: 16px;
      }

      input[type="file"] {
        display: block;
      }

      button {
        padding: 8px 18px;
        font-size: 14px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        background-color: #2563eb;
        color: #ffffff;
      }

      button:disabled {
        background-color: #9ca3af;
        cursor: default;
      }

      .status {
        margin-top: 12px;
        font-size: 14px;
        color: #555;
      }

      .results {
        margin-top: 20px;
        padding-top: 12px;
        border-top: 1px solid #e5e7eb;
      }

      .results h2 {
        margin: 0 0 8px;
        font-size: 18px;
      }

      .results ul {
        margin: 0;
        padding-left: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>MLZoomCamp - Capstone Project</h1>
      <p class="subtitle">Upload an Image of a vegetable here</p>

      <div class="field">
        <input type="file" id="file-input" accept="image/*" />
      </div>

      <button id="predict-btn">Predict</button>

      <div id="status" class="status"></div>

      <div id="results" class="results" style="display: none">
        <h2>Predictions</h2>
        <div id="top-prediction"></div>
        <ul id="prediction-list"></ul>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById("file-input");
      const predictBtn = document.getElementById("predict-btn");
      const statusEl = document.getElementById("status");
      const resultsEl = document.getElementById("results");
      const topPredictionEl = document.getElementById("top-prediction");
      const predictionListEl = document.getElementById("prediction-list");

      predictBtn.addEventListener("click", async () => {
        const file = fileInput.files[0];
        if (!file) {
          statusEl.textContent = "Please select an image first.";
          resultsEl.style.display = "none";
          return;
        }

        const formData = new FormData();
        formData.append("file", file);

        predictBtn.disabled = true;
        statusEl.textContent = "Sending image for prediction...";

        try {
          const response = await fetch("/predict", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const err = await response.json().catch(() => ({}));
            const message =
              err.error || `Request failed with status ${response.status}`;
            throw new Error(message);
          }

          const data = await response.json();

          const top = data.top_prediction;
          const items = data.predictions || [];

          topPredictionEl.textContent = top
            ? `Top prediction: ${top.class} (${(top.probability * 100).toFixed(
                1
              )}%)`
            : "No prediction returned.";

          predictionListEl.innerHTML = "";
          items.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = `${item.class} - ${(item.probability * 100).toFixed(
              1
            )}%`;
            predictionListEl.appendChild(li);
          });

          resultsEl.style.display = "block";
          statusEl.textContent = "";
        } catch (err) {
          resultsEl.style.display = "none";
          statusEl.textContent = `Error: ${err.message}`;
        } finally {
          predictBtn.disabled = false;
        }
      });
    </script>
  </body>
  </html>

